import React, { useState } from "react";
import { API_BASE, getOverview, getRecommendations, getCreatives, postForecast, generatePdf } from "./api";

export default function App() {
  const [log, setLog] = useState<string>("Готово.\n");
  const add = (s: string) => setLog((p) => p + s + "\n");

  const probeAll = async () => {
    try {
      add("→ /api/overview");        add("✓ " + JSON.stringify(await getOverview()));
      add("→ /api/recommendations"); add("✓ " + JSON.stringify(await getRecommendations()));
      add("→ /api/creatives");       add("✓ " + JSON.stringify(await getCreatives()));
      add("→ /api/forecast");        add("✓ " + JSON.stringify(await postForecast({ budget: 100 })));
      add("Готово.");
    } catch (e: any) { add("Ошибка: " + (e?.message ?? String(e))); }
  };

  const downloadPdf = async () => {
    try {
      add("→ /api/report/pdf");
      const blob = await generatePdf();
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url; a.download = "test-cyr.pdf"; a.click();
      URL.revokeObjectURL(url);
      add("✓ PDF скачан (test-cyr.pdf)");
    } catch (e: any) { add("Ошибка PDF: " + (e?.message ?? String(e))); }
  };

  return (
    <div style={{ fontFamily: "system-ui, Arial", padding: 16 }}>
      <h1>AdsRays Demo (минимальный UI)</h1>
      <div style={{ marginBottom: 8 }}>API_BASE: <code>{API_BASE}</code></div>
      <div style={{ display: "flex", gap: 8, marginBottom: 12 }}>
        <button onClick={probeAll}>Проверить API</button>
        <button onClick={downloadPdf}>PDF для партнёра</button>
      </div>
      <textarea readOnly style={{ width: "100%", height: 320 }} value={log} />
    </div>
  );
}
